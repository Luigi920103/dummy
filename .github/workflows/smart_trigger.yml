name: Smart QA Trigger

on:
  push:
    branches: [ main ]

jobs:
  dispatch-logic:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ” Checkout Code
        uses: actions/checkout@v4
      
      # 1. Filtro para detectar quÃ© carpetas cambiaron
      - name: ğŸ“‚ Check Changed Paths
        uses: dorny/paths-filter@v3
        id: filter
        with:
          filters: |
            pw_ts_bdd: ['pw_ts_bdd/**']
            pw_ts: ['pw_ts/**']
            pw_js_bdd: ['pw_js_bdd/**']
            pw_js: ['pw_js/**']

      # 2. EnvÃ­o al Orquestador
      - name: ğŸš€ Dispatch to Orchestrator
        # Solo dispara si el filtro detectÃ³ cambios en alguna carpeta
        if: steps.filter.outputs.changes != '[]'
        uses: peter-evans/repository-dispatch@v2
        with:
          token: ${{ secrets.ORCHESTRATOR_TOKEN }}
          repository: Luigi920103/qa-orchestrator
          event-type: trigger-automation
          # Usamos un formato de JSON robusto en una sola lÃ­nea
          client_payload: '{"pw_ts_bdd_changed": "${{ steps.filter.outputs.pw_ts_bdd }}", "pw_ts_changed": "${{ steps.filter.outputs.pw_ts }}", "pw_js_bdd_changed": "${{ steps.filter.outputs.pw_js_bdd }}", "pw_js_changed": "${{ steps.filter.outputs.pw_js }}", "env": "dev"}'
